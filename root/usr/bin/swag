#!/usr/bin/with-contenv bash

SRV=$1
CMD=$2

if [ "$SRV" = "nginx" ]; then
	if [ "$CMD" = "restart" ]; then
		echo "Restarting Nginx"
		s6-svc -h /var/run/s6/services/nginx
		exit 0
	fi
	if [ "$CMD" = "test" ]; then
		nginx -t -c /config/nginx/nginx.conf
		exit 0
	fi
fi
if [ "$SRV" = "php" ]; then
	if [ "$CMD" = "restart" ]; then
		echo "Restarting PHP-FPM"
		s6-svc -t /var/run/s6/services/php-fpm
		exit 0
	fi
	if [ "$CMD" = "test" ]; then
		php -e -c /etc/php8/php.ini -r 'echo "PHP Configuration OK\n";'
		exit 0
	fi
fi
echo "Invalid usage, use 'swag <nginx/php> <restart/test>'"
exit 1
